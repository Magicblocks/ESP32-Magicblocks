#pragma once
#include "Arduino.h"
#include "Globals.h"
#include <EEPROM.h>
#include <WiFi.h>
#include <ESPAsyncWebServer.h>
#include <SPIFFS.h>
#define CONFIG_OFFSET 0


const char indexHtml[] PROGMEM = R"rawliteral(<html><head><title>ESP32 Config</title><style>.mm {font-size:smaller;font-weight:600;padding-left: 20px;}tr {padding:20px;}.g2{display: none;}.g3{display: none;}.gt {    text-align: center;    color: #f0f8ff;    font-weight: 600;    background-color: #3a6475;}</style><script type="text/javascript">function load(item){var objs=document.getElementsByClassName('gx');console.log(objs);for(var i=0;i<objs.length;i++){objs[i].style.display="none";}objs=document.getElementsByClassName(item);console.log(objs);for(var i=0;i<objs.length;i++){objs[i].style.display="table-row";}}function save(){var pw=prompt("Please enter admin password","");if(pw===null)return;document.getElementById("password").value=pw;document.getElementById("f").submit();}if(%s){alert("Initial Setup\n1. Set device Id and key of the device for Magicblocks\n2. Select the SSID and the password for WiFi.\n3. Click Save and enter admin password when prompted.");}</script></head><body style="background-color:#002e40;text-align:center"><div style="text-align:center;vertical-align: middle;color: #e9edef;font-size: xx-large;font-family: sans-serif;font-weight: 900;height: 20%%;max-height: 125px;"><div>ESP32 Configuration<br><div style="    background-color: aliceblue;"><a class="mm" href="javascript:load('g1')">Setup</a><a class="mm" href="javascript:load('g3')">Admin</a></div></div></div><form id="f" style="text-align:center;height:50%%" action="http://192.168.4.1/submit" method="POST"><table style="margin:0 auto;color:white;font-size: medium;font-family:sans-serif;top:30%%;position:relative;width:80%%;max-width:600px;"><tbody><tr class="gx g1"><td class="gt">Magicblocks Settings</td><td class="gt"></td></tr><tr class="gx g1"><td>Status:</td><td><span style="color:#85ff66">%s</span><span style="color:#ff6464">%s</span></td></tr><tr class="gx g1"><td>Name:</td><td><input type="text" name="n" value="%s"></td></tr><tr class="gx g1"><td>DeviceId: <span style="font-size:small">(eg: idxx-xxxxxxxxx)</span></td><td><input type="text" name="d" value="%s"></td></tr><tr class="gx g1"><td>Key:</td><td><input type="password" name="k" value=""></td></tr><tr class="gx g1"><td class="gt">WiFi Settings</td><td class="gt"></td></tr><tr class="gx g1"><td>Status:</td><td><span style="color:#85ff66">%s</span><span style="color:#ff6464">%s</span></td></tr><tr class="gx g1"><td>SSID:<span style="font-size:small">(select or enter)</span></td><td><input list="aps" name="s" id="s">  <datalist id="aps">    %s  </datalist></td></tr><tr class="gx g1"><td>Password:</td><td><input type="password" name="wp" value=""></td></tr><tr class="gx g3"><td class="gt">Admin Settings</td><td></td></tr><tr class="gx g3"><td>New Password:</td><td><input type="password" name="np"></td></tr><tr class="gx g3"><td>Confirm new password:</td><td><input type="password" name="npc"></td></tr><tr><td></td><td><input type="button" value="Save" style="font-size: medium;font-family: sans-serif;color: white;background-color: #335fff;" onclick="save()"></td></tr></tbody></table><input type="hidden" id="password" name="p" value=""></form></body></html>)rawliteral";
const char submitHtml[] PROGMEM = R"rawliteral(<html><head><title>ESP32 Config</title></head><body style="background-color:#002e40;text-align:center"><div style="text-align:center;vertical-align: middle;color: #f0f8ff;font-size: xx-large;font-family: sans-serif;font-weight: 900;height: 20%%;max-height: 125px;"><img src="logo" style="padding-left:20px;float:left;max-width: 20%%"><div>ESP32 Configuration<br></div></div><form id="f" style="text-align:center;height:50%%" action="http://192.168.4.1/submit" method="POST"><table style="margin:0 auto;color:white;font-size:x-large;font-family:sans-serif;top:30%%;position:relative;width:80%%;max-width:600px;font-size:medium;"><tbody><tr class="gx g1"><td>%s</td></tr><tr class="gx g1" style="font-size:smaller"><td>%s</td></tr></tbody></table><input type="hidden" id="password" name="p" value=""></form><input type="button" value="Back" style="font-size: x-large;font-family: sans-serif;color: white;background-color: #335fff;" onclick="location.href='http://192.168.4.1/'"></body></html>)rawliteral";


bool configInit();
void configServerInit();
int serializeConfig();
bool deserializeConfig();
void eraseConfig();
